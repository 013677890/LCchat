## 数据库设计汇总（当前版本）

> 说明：UUID 长度当前均为 `char(20)`，保持跨表一致；如需更安全可调整为 ULID/UUID 压缩（char 26/32）。

### user_info（用户基础信息）
- `id` bigint PK，自增  
- `uuid` char(20) 唯一，用户唯一标识  
- `nickname` varchar(20) 昵称  
- `telephone` varchar(20) 唯一，电话  
- `email` varchar(100) 邮箱  
- `avatar` varchar(255) 头像 URL（DB 默认外链；可改为默认空串，由应用填充）  
- `gender` tinyint，0 男 1 女（建议加 2 未知）  
- `signature` varchar(100) 个性签名  
- `password` char(60) 密码哈希（bcrypt）  
- `birthday` char(8) 生日（yyyyMMdd，建议改用 date）  
- `is_admin` tinyint，0/1  
- `status` tinyint，0 正常 1 禁用  
- `created_at` datetime，`updated_at` datetime，`deleted_at` datetime（软删）

### group_info（群基础信息）
- `id` bigint PK，自增  
- `uuid` char(20) 唯一，群唯一 ID  
- `name` varchar(64) 群名称  
- `notice` varchar(500) 群公告  
- `member_cnt` int，群人数，默认 1  
- `owner_uuid` char(20) 群主 UUID（索引）  
- `add_mode` tinyint，0 直接 1 审核  
- `avatar` varchar(255) 群头像 URL（DB 默认外链；可改为默认空串，由应用填充）  
- `status` tinyint，0 正常 1 禁用 2 解散  
- `created_at` autoCreateTime，`updated_at` autoUpdateTime，`deleted_at` 软删

### group_member（群成员关系）
- `id` bigint PK，自增  
- `group_uuid` char(20) 群 UUID，索引 & unique 组合  
- `user_uuid` char(20) 用户 UUID，索引 & unique 组合  
- 组合唯一索引 `(group_uuid, user_uuid)` 防重复入群  
- `role` tinyint，0 成员 1 管理员 2 群主  
- `remark` varchar(64) 群备注/名片  
- `status` tinyint，0 正常 1 退出 2 踢出 3 待审核  
- `mute_until` datetime 可空，禁言到期  
- `inviter_uuid` char(20) 邀请人  
- `joined_at` autoCreateTime，`created_at` autoCreateTime，`updated_at` autoUpdateTime，`deleted_at` 软删

### user_relation（用户关系，单向）
- `id` bigint PK，自增  
- `user_uuid` char(20) 发起方 UUID  
- `peer_uuid` char(20) 对端 UUID  
- 组合唯一索引 `(user_uuid, peer_uuid)` 防重复关系  
- `status` tinyint：0 待确认 1 已添加 2 已拉黑 3 已拒绝  
- `remark` varchar(64) 备注  
- `source` varchar(64) 添加来源（手机号/群/二维码等）  
- `group_tag` varchar(32) 标签  
- `created_at` autoCreateTime，`updated_at` autoUpdateTime，`deleted_at` 软删

## 关联与约束建议
- 所有 UUID 长度保持一致（当前 char(20)）。如切换 ULID/UUID，需同时调整四表字段长度与索引。
- 数据库层如需外键约束：  
  - `group_member.group_uuid` → `group_info.uuid`  
  - `group_member.user_uuid` → `user_info.uuid`  
  - `group_info.owner_uuid` → `user_info.uuid`  
  - `user_relation.user_uuid` / `peer_uuid` → `user_info.uuid`  
  默认 GORM 不自动建 FK，可在迁移后手工添加。
- 建议索引：  
  - `user_info`: `unique(uuid)`, `unique(telephone)`, `unique(email)`（可选）  
  - `group_info`: `unique(uuid)`, `index(owner_uuid)`, `index(status)`  
  - `group_member`: `unique(group_uuid, user_uuid)`, `index(role)`, `index(status)`  
  - `user_relation`: `unique(user_uuid, peer_uuid)`, `index(status)`

## 待决策/改进项
- UUID 长度与格式：是否改为 ULID/UUID（char 26/32 或 binary16）。  
- 头像默认值：是否改为应用层填充，DB 默认空串。  
- `birthday` 字段：是否改用 `date` 类型。  
- 外键约束：是否在 DB 层显式加 FK，或仅依赖应用层校验。  
- 枚举取值：gender 增加“未知”，status/role 枚举与业务逻辑保持一致。  
  

